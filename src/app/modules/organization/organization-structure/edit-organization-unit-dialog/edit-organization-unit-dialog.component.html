@if (unit$ | async; as unit) {
  @if (unitPermissions$ | async; as permissions) {
    <app-dialog
      [title]="'Rediger ' + unit.name"
      i18n-title
      backgroundColor="grey"
      [noPadding]="true"
      >
      <div class="content">
        <div class="grid-container">
          <app-standard-vertical-content-grid class="basic-information-section">
            <app-paragraph paragraphSize="large" [bold]="true" i18n>Information om enhed</app-paragraph>
            <div>
              <app-org-unit-select
                [text]="(getParentUnitDropdownText() | async) ?? ''"
                i18n-text
                [disabledUnitsUuids]="(disabledUnitsUuids$ | async) ?? []"
                [clearable]="false"
                [formGroup]="baseInfoForm"
                formName="parentUnitControl"
              ></app-org-unit-select>
              <app-textbox-info i18n>{{ getParentUnitHelpText() | async }}</app-textbox-info>
            </div>
            <app-textbox
              [value]="unit.name"
              text="Enhedens navn"
              i18n-text
              [formGroup]="baseInfoForm"
              formName="nameControl"
              data-cy="name-control"
              [disabled]="!permissions.canBeRenamed"
            ></app-textbox>
            <app-numeric-input
              [value]="unit.ean"
              text="EAN nummer"
              i18n-text
              [formGroup]="baseInfoForm"
              formName="eanControl"
              data-cy="ean-control"
              [disabled]="!permissions.canEanBeModified"
            ></app-numeric-input>
            <app-textbox
              [value]="unit.unitId"
              text="Enhedens ID"
              i18n-text
              [formGroup]="baseInfoForm"
              formName="idControl"
              data-cy="id-control"
              [disabled]="!permissions.canDeviceIdBeModified"
            ></app-textbox>
            @if (permissions.canBeModified) {
              <app-dialog-actions>
                <app-button [color]="confirmColor" size="large" (buttonClick)="onSave()" i18n data-cy="save-button"
                  >Gem</app-button
                  >
                </app-dialog-actions>
              }
            </app-standard-vertical-content-grid>
            <div class="registrations-section-container">
              <app-paragraph class="registrations-section-title-padding" paragraphSize="large" [bold]="true" i18n
                >Registeringer for: {{ unit.name }}</app-paragraph
                >
                <!-- Check if it's loading -->
                @if ((isLoading$ | async) === false) {
                  <!-- Check for empty state -->
                  @if (anyRegistrations$ | async) {
                    <app-standard-vertical-content-grid class="registrations-section">
                      @if (permissions.canEditRegistrations) {
                        <app-org-unit-select
                          text="Overfør til"
                          i18n-text
                          [value]="selectedTransferUnit"
                          [disabledUnitsUuids]="[unit.uuid]"
                          (valueChange)="onUnitSelectionChange($event)"
                          data-cy="transfer-to-unit-select"
                        ></app-org-unit-select>
                      }
                      @if (hasOrganizationUnitRights$ | async) {
                        <app-registrations-roles-section
                          [unitUuid]="unit.uuid"
                          registrationType="unitRights"
                          [roleRegistrations$]="organizationUnitRegistrations$"
                          [areAllSelected$]="allOrganizationUnitRightsSelected$"
                          [canEditRegistrations]="permissions.canEditRegistrations ?? false"
                        ></app-registrations-roles-section>
                      }
                      @if (hasInternalPayments$ | async) {
                        <app-registrations-payments-section
                          [unitUuid]="unit.uuid"
                          registrationType="internalPayment"
                          [paymentRegistrations$]="internalPaymentsRegistrations$"
                          [areAllSelected$]="allInternalPaymentsSelected$"
                          [canEditRegistrations]="permissions.canEditRegistrations ?? false"
                          >
                        </app-registrations-payments-section>
                      }
                      @if (hasExternalPayments$ | async) {
                        <app-registrations-payments-section
                          [unitUuid]="unit.uuid"
                          registrationType="externalPayment"
                          [paymentRegistrations$]="externalPaymentsRegistrations$"
                          [areAllSelected$]="allExternalPaymentsSelected$"
                          [canEditRegistrations]="permissions.canEditRegistrations ?? false"
                          >
                        </app-registrations-payments-section>
                      }
                      @if (hasItContractRegistrations$ | async) {
                        <app-registrations-page-details-section
                          [unitUuid]="unit.uuid"
                          registrationType="itContract"
                          [registrations$]="itContractRegistrations$"
                          [areAllSelected$]="allItContractRegistrationsSelected$"
                          entityType="it-contract"
                          (navigateToDetailsPage)="onNavigateToDetailsPage()"
                          [canEditRegistrations]="permissions.canEditRegistrations ?? false"
                        ></app-registrations-page-details-section>
                      }
                      @if (hasRelevantSystems$ | async) {
                        <app-registrations-page-details-section
                          [unitUuid]="unit.uuid"
                          registrationType="relevantSystem"
                          [registrations$]="relevantSystemsRegistrations$"
                          [areAllSelected$]="allRelevantSystemsSelected$"
                          entityType="it-system-usage"
                          subpagePath="organization"
                          (navigateToDetailsPage)="onNavigateToDetailsPage()"
                          [canEditRegistrations]="permissions.canEditRegistrations ?? false"
                        ></app-registrations-page-details-section>
                      }
                      @if (hasResponsibleSystems$ | async) {
                        <app-registrations-page-details-section
                          [unitUuid]="unit.uuid"
                          registrationType="responsibleSystem"
                          [registrations$]="responsibleSystemsRegistrations$"
                          [areAllSelected$]="allResponsibleSystemsSelected$"
                          entityType="it-system-usage"
                          subpagePath="organization"
                          (navigateToDetailsPage)="onNavigateToDetailsPage()"
                          [canEditRegistrations]="permissions.canEditRegistrations ?? false"
                        ></app-registrations-page-details-section>
                      }
                    </app-standard-vertical-content-grid>
                  }
                  <!-- Display empty state -->
                  @if ((anyRegistrations$ | async) === false) {
                    <app-empty-state
                      class="vertical-center-container"
                      [text]="'Der er ingen registreringer, der anvender ' + unit.name"
                      context="emptyTable"
                      i18n
                    ></app-empty-state>
                  }
                }
                <!-- Loading state -->
                @if ((isLoading$ | async) !== false) {
                  <app-loading class="vertical-center-container"></app-loading>
                }
                <!-- Snackbar -->
                @if (selectedRegistrationsCount$ | async; as numberOfRegistrations) {
                  @if (numberOfRegistrations > 0) {
                    <app-snackbar-actions data-cy="actions-snackbar">
                      <app-paragraph color="white" paragraphSize="medium" [dimmed]="true" i18n
                        >Vælg handling for valgte registreringer ({{ numberOfRegistrations }})</app-paragraph
                        >
                        <div class="right-buttons">
                          <app-button
                            color="secondary"
                            buttonStyle="secondary"
                            size="small"
                            data-cy="delete-selected-button"
                            (buttonClick)="deleteSelected(unit.uuid)"
                            i18n
                            >Slet</app-button
                            >
                            <app-button
                              color="secondary"
                              size="small"
                              [disabled]="!selectedTransferUnit"
                              [tooltip]="!selectedTransferUnit ? disabledTransferButtonTooltip : ''"
                              data-cy="transfer-selected-button"
                              (buttonClick)="transferSelected(unit.uuid)"
                              i18n
                              >Overfør</app-button
                              >
                            </div>
                          </app-snackbar-actions>
                        }
                      }
                    </div>
                  </div>
                </div>
                <div class="dialog-footer">
                  <div>
                    @if (permissions.canBeDeleted) {
                      <app-button
                        i18n
                        buttonStyle="tertiary"
                        color="warn"
                        data-cy="delete-unit-button"
                        (buttonClick)="openDeleteDialog()"
                        ><app-trashcan-icon></app-trashcan-icon> Slet enhed</app-button
                        >
                      }
                    </div>
                    @if ((anyRegistrations$ | async) === true) {
                      <div class="right-buttons">
                        <app-button
                          buttonStyle="secondary"
                          [color]="'accent'"
                          i18n
                          data-cy="deselect-all-button"
                          [disabled]="(noRegistrationsSelected$ | async) === true"
                          (buttonClick)="changeSelectAllRegistrationsState(false)"
                          >Fravælg alle</app-button
                          >
                          <app-button
                            i18n
                            buttonStyle="secondary"
                            color="accent"
                            data-cy="select-all-button"
                            [disabled]="(allRegistrationsSelected$ | async) === true"
                            (buttonClick)="changeSelectAllRegistrationsState(true)"
                            >Vælg alle</app-button
                            >
                          </div>
                        }
                      </div>
                    </app-dialog>
                  }
                }
