<div class="page-title-container">
  <h3 data-cy="organization-page-title" class="page-title" i18n>Organisation</h3>
  <app-help-button helpTextKey="organization.structure"></app-help-button>
</div>
<div class="structure-page-flex">
  <app-card class="structure-section-width resizable-right">
    <div class="card-header">
      <h6 i18n>Organisationslag</h6>
      @if (unitPermissions$ | async; as permissions) {
        @if (permissions.canBeModified) {
          <app-menu-button
            iconType="dots"
            buttonStyle="tertiary"
            class="align-end"
            data-cy="actions-button"
            >
            <app-menu-button-item i18n (itemClick)="openCreateSubUnitDialog()"
              ><app-plus-icon-blue></app-plus-icon-blue> Opret ny enhed</app-menu-button-item
              >
              <app-menu-button-item i18n (itemClick)="changeDragState()" data-cy="restructure-button"
                ><app-reorder-icon></app-reorder-icon> Omstrukturer</app-menu-button-item
                >
              </app-menu-button>
            }
          }
        </div>
        @if (currentUnitUuid$ | async; as currentUnitUuid) {
          <app-standard-vertical-content-grid>
            @if ((isDragDisabled$ | async) === false) {
              <app-button
                buttonStyle="secondary"
                (buttonClick)="changeDragState()"
                data-cy="finish-restructure-button"
                i18n
                >Færdig</app-button
                >
              }
              <app-drag-and-drop-tree
                itemType="organization"
                [currentNodeUuid]="currentUnitUuid"
                [nodes]="(unitTree$ | async) ?? []"
                [disableDrag]="(isDragDisabled$ | async) ?? true"
                (nodeMoved)="moveNode($event)"
                (nodeExpandClick)="nodeExpandClick($event)"
              ></app-drag-and-drop-tree>
              @if ((hasFkOrg$ | async) === true) {
                <div>
                  <app-paragraph paragraphSize="x-small" [dimmed]="true" i18n
                    ><app-kitos-unit-color-icon></app-kitos-unit-color-icon> Enheder oprettet i Kitos</app-paragraph
                    >
                    <app-paragraph paragraphSize="x-small" [dimmed]="true" i18n
                      ><app-fk-org-color-icon></app-fk-org-color-icon> Enheder synkroniseret fra FK Organisation</app-paragraph
                      >
                    </div>
                  }
                </app-standard-vertical-content-grid>
              }

              @if ((currentUnitUuid$ | async) === undefined) {
                <app-loading></app-loading>
              }
            </app-card>
            <div class="flex-roles-section">
              <app-card>
                <app-details-header [title$]="currentUnitName$" i18n-title>
                  <app-checkbox-button (valueChange)="checkboxChange($event)" i18n>
          Tilføj brugere fra underenheder
        </app-checkbox-button>

                  @if (unitPermissions$ | async; as permissions) {
                    @if (permissions.canBeModified) {
                      <app-button
                        buttonStyle="secondary"
                        i18n
                        (buttonClick)="onClickEdit()"
                        data-cy="edit-button"
                        >Rediger enhed</app-button
                        >
                      }
                    }
                  </app-details-header>

                  @if (currentUnitName$ | async; as unitName) {
                    <app-org-unit-role-table
                      [unitName]="unitName"
                      [checkboxSubject$]="includeSubnits$"
                      entityType="organization-unit"
                      [entityUuid$]="currentUnitUuid$"
                      [hasModifyPermission]="(modificationPermission$ | async) || false"
                      >
                    </app-org-unit-role-table>
                  }
                </app-card>
              </div>
            </div>
