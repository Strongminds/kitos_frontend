<app-scrollbar-dialog [title]="title" backgroundColor="grey">
  <app-paragraph [bold]="true" paragraphSize="x-large" i18n
    >Opsummering af konsekvenser ved flytning af anvendelse</app-paragraph
  >

  <app-standard-vertical-content-grid [id]="consequencesContentId">
    <app-paragraph i18n>
      For at sikre datakvaliteten i Kitos - og f.eks. komme redundante registreringer til livs - har global admin
      mulighed for at flytte jeres anvendelse fra et IT-system til et andet. I forbindelse med, at global admin har
      flyttet jeres system anvendelse fra et IT-system til et andet, kan det oplyses at:
    </app-paragraph>

    <ng-container *ngIf="(loading$ | async) !== true">
      <ng-container *ngIf="migration$ | async as migration">
        <app-card>
          <app-paragraph i18n [bold]="true" paragraphSize="medium">Systemanvendelsen flyttes:</app-paragraph>
          <app-native-table>
            <thead>
              <th i18n>Fra</th>
              <th i18n>Til</th>
            </thead>
            <tbody>
              <tr>
                <td>
                  <app-paragraph>
                    {{ migration.fromSystem?.name }}
                  </app-paragraph>
                </td>
                <td>
                  <app-paragraph>
                    {{ migration.toSystem?.name }}
                  </app-paragraph>
                </td>
              </tr>
            </tbody>
          </app-native-table>
        </app-card>

        <app-card *ngIf="hasContractsConsequences() | async">
          <app-usage-migration-consequences-table
            title="Følgende registreringer i modulet 'Kontrakter' berøres:"
            i18n-title
            [consequences]="migration.affectedContracts ?? []"
          >
          </app-usage-migration-consequences-table>
        </app-card>

        <app-card *ngIf="hasDprConsequences() | async">
          <app-usage-migration-consequences-table
            title="Følgende registreringer i modulet 'Databehandling' berøres:"
            i18n-title
            [consequences]="migration.affectedDataProcessingRegistrations ?? []"
          >
          </app-usage-migration-consequences-table>
        </app-card>
        <app-card *ngIf="hasRelationsConsequences() | async">
          <app-native-table>
            <app-paragraph i18n [bold]="true" paragraphSize="medium">Følgende systemrelationer berøres:</app-paragraph>
            <app-native-table>
              <thead>
                <th i18n>Anvendersystem</th>
                <th i18n>Udstillersystem</th>
                <th i18n>Relationsbeskrivelse</th>
                <th i18n>Snitflade der fjernes fra relationen</th>
                <th i18n>Frekvens</th>
                <th i18n>Kontrakt</th>
              </thead>
              <tbody>
                <tr *ngFor="let relation of migration.affectedRelations">
                  <td>
                    <app-paragraph i18n>
                      Navn: {{ formatSystemName(relation.fromSystem?.name, relation.fromSystem?.deactivated) }}
                      <br />
                      Uuid: {{ relation.fromSystem?.uuid }}
                    </app-paragraph>
                  </td>
                  <td>
                    <app-paragraph i18n>
                      Navn: {{ formatSystemName(relation.toSystem?.name, relation.toSystem?.deactivated) }}
                      <br />
                      Uuid: {{ relation.toSystem?.uuid }}
                    </app-paragraph>
                  </td>
                  <td>
                    <app-paragraph>
                      {{ relation.description }}
                    </app-paragraph>
                  </td>
                  <td>
                    <app-paragraph i18n>
                      Navn: {{ relation.interface?.name }}
                      <br />
                      Uuid: {{ relation.interface?.uuid }}
                    </app-paragraph>
                  </td>
                  <td>
                    <app-paragraph>
                      {{ relation.frequencyType?.name }}
                    </app-paragraph>
                  </td>
                  <td *ngIf="relation.contract">
                    <app-paragraph i18n>
                      Navn: {{ relation.contract.name }}
                      <br />
                      Uuid: {{ relation.contract.uuid }}
                    </app-paragraph>
                  </td>
                  <td *ngIf="!relation.contract">
                    <app-paragraph i18n>Ingen kontrakt </app-paragraph>
                  </td>
                </tr>
              </tbody>
            </app-native-table>
          </app-native-table>
        </app-card>
      </ng-container>
    </ng-container>
  </app-standard-vertical-content-grid>

  <app-dialog-actions *ngIf="hasConsequences() | async">
    <app-checkbox
      [(value)]="hasAcceptedConsequences"
      labelPosition="after"
      text="Jeg forstår og accepterer ovenstående konsekvenser"
      i18n-text
    >
    </app-checkbox>
  </app-dialog-actions>
  <app-dialog-actions>
    <app-button
      *ngIf="hasConsequences() | async"
      (buttonClick)="copyConsequencesToClipboard()"
      i18n
      buttonStyle="secondary"
      [disabled]="(loading$ | async) === true"
    >
      Kopier til klipholder</app-button
    >
    <app-button (buttonClick)="onCancel()" i18n buttonStyle="secondary" [disabled]="(loading$ | async) === true">
      Annuller</app-button
    >
    <app-button
      (buttonClick)="onConfirm()"
      i18n
      [disabled]="(isConfirmDisabled() | async) === true || (loading$ | async) === true"
      color="warn"
      data-cy="execute-migration-button"
    >
      Gennemfør flytning
    </app-button>
  </app-dialog-actions>
  <app-loading *ngIf="(loading$ | async) === true"></app-loading>
</app-scrollbar-dialog>
