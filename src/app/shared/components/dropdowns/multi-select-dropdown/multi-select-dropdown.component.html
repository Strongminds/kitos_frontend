<ng-select
  #selectDropdown
  class="{{ size }} "
  [placeholder]="text"
  [fixedPlaceholder]="true"
  [items]="data ?? []"
  [bindLabel]="textField"
  [loading]="loading || false"
  [clearAllText]="clearAllText"
  [clearable]="clearable"
  [loadingText]="loadingText"
  [notFoundText]="notFoundText"
  [searchFn]="useExternalSearch ? externalSearch : searchFn ?? null"
  (search)="filter$.next($event.term)"
  (clear)="onClear()"
  (focus)="onFocus()"
  (open)="onOpen()"
  [multiple]="true"
  [required]="isRequired"
  [disabled]="disabled"
  [closeOnSelect]="false"
  [(ngModel)]="selectedValuesModel"
  (ngModelChange)="onSelected($event)"
  [addTagText]="addTagText"
  [addTag]="includeAddTag ? onCreateNew : false"
  data-cy="multi-select-dropdown"
>
  <ng-template ng-option-tmp let-item="item" let-item$="item$">
    <div class="select-option-row" [attr.data-cy]="item.dataCy">
      <input
        id="item-{{ item[textField] }}"
        type="checkbox"
        [(ngModel)]="item$.selected"
        [ngModelOptions]="{ standalone: true }"
        [disabled]="item.disabled"
      />
      @if (!showDescription || !(item[itemDescriptionField] || item.value?.[itemDescriptionField])) {
      <p class="select-option-text-margin">
        {{ item[textField] }}
      </p>
      } @else {
      <div class="item-with-description">
        {{ item[textField] }}
        <app-paragraph paragraphSize="small">{{ item[itemDescriptionField] || item.value?.[itemDescriptionField] }}</app-paragraph>
      </div>
      }
      @if (isTagFn(item)) {
      <div class="ng-clear-wrapper remove-tag-button" (click)="removeTag(item)">
        <span class="ng-clear">x</span>
      </div>
      }
    </div>
  </ng-template>
  <ng-template ng-multi-label-tmp let-items="items">
    <div class="value-textbox-margin ng-value">
      @for (item of items; track item; let isLast = $last) {
      <span class="ng-value-label">{{ item[textField] }}@if (!isLast) { ,&nbsp; }</span>
      }
    </div>
  </ng-template>
</ng-select>

@if(displayDescriptionLabel()){
<app-textbox-info>
  <app-paragraph paragraphSize="x-small">{{ descriptionLabelTitle }} {{ descriptions.join(", ") }}</app-paragraph>
</app-textbox-info>
}
