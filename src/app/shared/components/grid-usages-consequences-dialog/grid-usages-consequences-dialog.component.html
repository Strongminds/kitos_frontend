<app-scrollbar-dialog
  [title]="title"
>
  <app-paragraph
    [bold]="true"
    paragraphSize="x-large"
    i18n
  >Opsummering af konsekvenser ved flytning af anvendelse</app-paragraph>

  <app-standard-vertical-content-grid>
    <app-paragraph i18n>
      For at sikre datakvaliteten i Kitos – og f.eks. komme redundante registreringer til livs - har global admin mulighed for at flytte jeres anvendelse fra et IT-system til et andet.
      I forbindelse med, at global admin har flyttet jeres system anvendelse fra et IT-system til et andet, kan det oplyses at:
    </app-paragraph>

    <ng-container *ngIf="(migration$ | async) as migration">
      <app-card>
        <app-paragraph i18n [bold]="true" paragraphSize="medium">Systemanvendelsen flyttes:</app-paragraph>
        <app-native-table>
          <thead>
            <th i18n>Fra</th>
            <th i18n>Til</th>
          </thead>
          <tbody>
            <tr>
              <td>{{ migration.fromSystem?.name }}</td>
              <td>{{ migration.toSystem?.name }}</td>
            </tr>
          </tbody>
        </app-native-table>
      </app-card>

      <app-card *ngIf="hasContractsConsequences() | async">
        <app-usage-migration-consequences-table
        title="Følgende registreringer i modulet 'Kontrakter' berøres:"
        i18n-title
        [consequences]="migration.affectedContracts ?? []"
        >
        </app-usage-migration-consequences-table>
      </app-card>

      <app-card *ngIf="hasDprConsequences() | async">
        <app-usage-migration-consequences-table
        title="Følgende registreringer i modulet 'Databehandling' berøres:"
        i18n-title
        [consequences]="migration.affectedDataProcessingRegistrations ?? []"
        >
        </app-usage-migration-consequences-table>
      </app-card>
      <app-card *ngIf="hasRelationsConsequences() | async">
        <app-native-table>
          <app-paragraph i18n [bold]="true" paragraphSize="medium">Følgende systemrelationer berøres:</app-paragraph>
          <app-native-table>
            <thead>
              <th i18n>Anvendersystem</th>
              <th i18n>Udstillersystem</th>
              <th i18n>Relationsbeskrivelse</th>
              <th i18n>Snitflade der fjernes fra relationen</th>
              <th i18n>Frekvens</th>
              <th i18n>Kontrakt</th>
            </thead>
            <tbody>
              <tr *ngFor="let relation of migration.affectedRelations">
                <td i18n>
                  Navn: {{formatSystemName(relation.fromSystem?.name, relation.fromSystem?.deactivated) }}
                  <br />
                  Uuid: {{relation.fromSystem?.uuid}}
              </td>
              <td i18n>
                  Navn: {{formatSystemName(relation.toSystem?.name,relation.toSystem?.deactivated) }}
                  <br />
                  Uuid: {{ relation.toSystem?.uuid}}
              </td>
              <td>
                  {{relation.description}}
              </td>
              <td i18n>
                  Navn: {{relation._interface?.name}}
                  <br />
                  Uuid: {{relation._interface?.uuid}}
              </td>
              <td>
                  {{relation.frequencyType?.name}}
              </td>
              <td *ngIf="relation.contract" i18n>
                  Navn: {{relation.contract.name}}
                  <br />
                  Uuid: {{relation.contract.uuid}}
              </td>
              <td *ngIf="!relation.contract" i18n>
                Ingen kontrakt</td>
              </tr>
            </tbody>
          </app-native-table>
        </app-native-table>
      </app-card>
    </ng-container>
    <app-dialog-actions *ngIf="hasConsequences() | async">
      <app-checkbox
        [(value)]="hasAcceptedConsequences"
        labelPosition="after"
        text="Jeg forstår og accepterer ovenstående konsekvenser"
        i18n-text
      >
      </app-checkbox>
    </app-dialog-actions>
    <app-dialog-actions>
      <app-button
        (buttonClick)="onCancel()"
        i18n
      >
      Annuler</app-button>
      <app-button
        (buttonClick)="onConfirm()"
        i18n
        [disabled]="(isConfirmDisabled() | async) === true"
        >
        Gennemfør flytning
      </app-button>
    </app-dialog-actions>
    <app-loading *ngIf="(loading$ | async) === true"></app-loading>
  </app-standard-vertical-content-grid>

</app-scrollbar-dialog>
